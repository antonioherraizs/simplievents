<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Simplilog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <link href="css/codiqa.ext.min.css" rel="stylesheet">
  <link href="css/jquery.mobile-1.3.1.min.css" rel="stylesheet">

  <script src="js/jquery-1.9.1.min.js"></script>
  <script src="js/jquery.mobile-1.3.1.min.js"></script>
  <script src="js/jquery.cookie.js"></script>
  <script src="js/codiqa.ext.min.js"></script>

  <script src="js/simplilog.js"></script>
  <!-- consider moving the stuff below to js/simplilog.js later, hehehe -->

  <script type="text/javascript">

  $(function() {

    $(document).ready(function () {
        $('.login-form').on('click', '#login-button', login);
        $('.login-form').on('click', '#get-button', get_test);
    });

    var milliseconds = 0;
    var logURL = "";

    function login() {
      $.ajax({
          type: "POST",
          //url: "httpS://
          url: "https://simplisafe.com/my-account/login",
          //url: "print_request.php",
          cache: false,
          //crossDomain: true,
          data: {
            name: $('#user-field').val(), 
            pass: $('#password-field').val(),
            form_id: 'user_login',
            op: 'Log in',
          },
          //dataType: 'json', // will return error if response is not JSON
          // xhrFields: {
          //   withCredentials: true
          // }
      })
        .done(function( data ) {
          //alert( "success" );
          alert(data.slice( 0, 100 ));
          if ( console && console.log ) {
            console.log( "returned POST:", data );
          }
          $('#text-output').empty();
          $('#text-output').text("<p>" + data + "</p>");

          milliseconds = (new Date).getTime();
          if (data.d) { data = data.d }
          alert(data);
          var $r = $(data);
          logURL = $r.filter("link[rel='canonical']").attr('href') + '/utility/tables?_=' + milliseconds + '&&table=event-log-table';
          alert(logURL);
        })
        .fail(function( e ) {
          alert( "Error " + e.responseStatus + ": " + e.responseText );
        });
    }

    function get_test() {
      alert(logURL);
      $.ajax({
          type: "GET",
          //url: "http://www.elbanking.com/print_request.php?test=1",
          url: logURL,
          cache: false,
          //crossDomain: true,
      })
        .done(function( data ) {
          //alert( "success" );
          // alert(data.slice( 0, 100 ));
          // if ( console && console.log ) {
          //   console.log( "returned GET:", data );
          // }
          // create jQuery object from the response HTML
          if (data.d) { data = data.d }
          alert(data);
          var $response = $(data);

          var table = $response.filter('table').html();
          alert(table);
        })
        .fail(function( e ) {
          alert( "Error " + e.responseStatus + ": " + e.responseText );
        });
    }
  });


    // format them and replace items in list-view
  </script>
</head>
<body>

  <div data-role="page" data-theme="b" id="page-login">
      <div data-role="header" data-theme="b">
          <h1>Login to Simplisafe</h1>
      </div>
      <div data-role="content" class="login-form">
          <form>
              <label for="user-field">User</label>
              <textarea id="user-field"></textarea>
              <label for="password-field">Pass</label>
              <textarea id="password-field"></textarea>
          </form>
          <button id="login-button" data-inline="true">Login</button>
          <button id="get-button" data-inline="true">GET</button>
      </div>
  </div>

  <div data-role="page" data-control-title="Home" id="page-events">
      <div data-theme="a" data-role="header">
          <h3>
              Event Log
          </h3>
      </div>
      <div data-role="content">
          <ul data-role="listview" data-inset="false" data-filter="true">
              <li>
                  <h3>H3 Text</h3>
                  <p>This is just a bunch of paragraph text</p>
              </li>
          </ul>
          <hr style="height:3px; background-color:#000; border:0; margin-top:12px; margin-bottom:12px;">
          <div data-controltype="textblock" id="text-output">
              <p>
                  TEST
              </p>
          </div>
      </div>
  </div>
</body>
</html>
